<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Professional Blog</title>
    <link rel="stylesheet" href="statics/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="#">یه بلاگر تازه کار</a>
            </div>
            <ul class="nav-menu">
                <li><a href="#home">خانه</a></li>
                <li><a href="#posts">بلاگ</a></li>
                <li><a href="#about">درباره من</a></li>
                <li><a href="#contact">تماس با من</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="content">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="hero-banner">
                <div class="hero-content">
                    <h1 class="hero-title">به وبلاگ من خوش آمدید</h1>
                    <p class="hero-subtitle">یه وبلاگ کوچولو برای یه سری محتوا ساده</p>
                    <div class="hero-buttons">
                        <a href="#posts" class="btn btn-primary">پست ها من</a>
                        <a href="#about" class="btn btn-secondary">درباره من</a>
                    </div>
                </div>
                <div class="hero-image">
                    <img src="media/banner-image.jpg" alt="Blog Banner" onerror="this.style.display='none'">
                </div>
            </div>

            <!-- Features Section -->
            <div class="features">
                <div class="feature-card">
                    <div class="feature-icon">📝</div>
                    <h3>پست های به روز</h3>
                    <p>سعی میکنم منظم پست جدید بزارم</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🔍</div>
                    <h3>محتوای خوب و معتبر</h3>
                    <p>سعیم اینه مطالب درست باشن. مشکلی بود یه ایمیل بزن خداییش</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">💬</div>
                    <h3>انجمن</h3>
                    <p>دوست دارم توی کانال اختصاصی که در تلگرام راه انداختم باشی.</p>
                </div>
            </div>
        </section>

        <!-- Posts Section -->
        <section id="posts" class="section">
            <div class="section-header">
                <h2>جدیدترین پست ها</h2>
                <p>آخرین پست هایی که منتشر کردم رو حتما یه نگاه بنداز.</p>
            </div>
            <div id="posts-container">
                <div class="loading">بارگذاری پست ها...</div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="section">
            <div class="section-header">
                <h2>محب یاراحمدی هستم</h2>
                <p>برنامه نویس و طراح سه بعدی</p>
            </div>
            <div class="about-content">
                <div class="about-image">
                    <img src="media/profile-pic.png" alt="Profile Picture" onerror="this.style.display='none'">
                </div>
                <div class="about-text">
                    <h3>درود بر تو دوست گرامی</h3>
                    <p>به وبلاگ ساده ای که دارم خوش آمدید.</p>
                    <p>عاشق ساخت بازی هستم. برنامه نویس و طراح سه بعدی هستم.
                        مربی پیرایشگر هم هستم خنده داره مگه نه؟ مطالب اینجا رو به عشق خودت مینویسم. عشق منی تو ❤❤❤
                    </p>
                    <div class="skills">
                        <span class="skill-tag">طراحی سه بعدی</span>
                        <span class="skill-tag">برنامه نویسی</span>
                        <span class="skill-tag">طراحی بازی</span>
                        <span class="skill-tag">پیرایشگر</span>
                        <span class="skill-tag">بازم هست</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="section">
            <div class="section-header">
                <h2>با هم در تماس باشیم</h2>
                <p>دوست دارم ازت بدونم</p>
            </div>
            <div class="contact-content">
                <div class="contact-info">
                    <div class="contact-item">
                        <div class="contact-icon">📧</div>
                        <div class="contact-details">
                            <h4>ایمیل من</h4>
                            <p>moheb.yarahmadi@gmail.com</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="contact-icon">🌐</div>
                        <div class="contact-details">
                            <h4>همین وبلاگ</h4>
                            <p>www.yourwebsite.com</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="contact-icon">📍</div>
                        <div class="contact-details">
                            <h4>جایی که هستم</h4>
                            <p>اینو فعلا نمیگم</p>
                        </div>
                    </div>
                </div>
                <div class="social-links">
                    <a href="#" class="social-link">
                        <img src="media/social-icons/github.svg" alt="GitHub" onerror="this.parentElement.innerHTML='🐱'">
                    </a>
                    <a href="#" class="social-link">
                        <img src="media/social-icons/twitter.svg" alt="Twitter" onerror="this.parentElement.innerHTML='🐦'">
                    </a>
                    <a href="#" class="social-link">
                        <img src="media/social-icons/linkedin.svg" alt="LinkedIn" onerror="this.parentElement.innerHTML='💼'">
                    </a>
                    <a href="#" class="social-link">
                        <img src="media/social-icons/email.svg" alt="Email" onerror="this.parentElement.innerHTML='📧'">
                    </a>
                </div>
            </div>
        </section>

        <!-- Single Post View (hidden by default) -->
        <section id="single-post" class="section" style="display: none;">
            <div id="post-content"></div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2025 مینی وبلاک شخصی من</p>
            <p>Powered by GitHub Pages & Markdown</p>
        </div>
    </footer>

    <script>
    // Configuration
    const REPO_OWNER = 'mohebyarahmadi';
    const REPO_NAME = 'blogforme';
    const POSTS_DIR = 'posts';

    // Navigation
    document.addEventListener('DOMContentLoaded', function() {
        // Handle navigation
        document.querySelectorAll('.nav-menu a, .hero-buttons a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                showSection(targetId);

                // Update URL without page reload
                history.pushState(null, '', `#${targetId}`);
            });
        });

        // Handle browser back/forward
        window.addEventListener('popstate', function() {
            const hash = window.location.hash.substring(1) || 'home';
            showSection(hash);
        });

        // Load initial section
        const initialSection = window.location.hash.substring(1) || 'home';
        showSection(initialSection);

        // Load posts for posts section
        if (initialSection === 'posts') {
            loadCategories();
        }
    });

    function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
            section.style.display = 'none';
        });

        // Show target section
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.style.display = 'block';
            setTimeout(() => targetSection.classList.add('active'), 10);
        }

        // Load posts if showing posts section
        if (sectionId === 'posts') {
            loadCategories();
        }

        // Update active nav link
        document.querySelectorAll('.nav-menu a').forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${sectionId}`) {
                link.classList.add('active');
            }
        });
    }

    // Load categories and their posts
    async function loadCategories() {
        const container = document.getElementById('posts-container');
        try {
            container.innerHTML = '<div class="loading">Loading categories and posts...</div>';

            const apiUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${POSTS_DIR}`;
            const response = await fetch(apiUrl);

            if (!response.ok) throw new Error(`Failed to fetch categories: ${response.status}`);

            const items = await response.json();
            const categories = items.filter(item => item.type === 'dir');

            if (categories.length === 0) {
                // If no categories, check for direct markdown files
                await loadAllPostsDirectly(container);
                return;
            }

            let html = '<div class="categories-container">';

            // Load posts for each category
            for (const category of categories) {
                const categoryPosts = await loadPostsFromCategory(category.name);
                html += renderCategorySection(category.name, categoryPosts);
            }

            html += '</div>';
            container.innerHTML = html;

            // Add event listeners to post cards
            document.querySelectorAll('.post-card-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    loadPost(this.getAttribute('data-file'), this.getAttribute('data-category'));
                });
            });

        } catch (error) {
            console.error('Error loading categories:', error);
            container.innerHTML = `<div class="error">Failed to load categories: ${error.message}</div>`;
        }
    }

    // Load posts from a specific category folder
    async function loadPostsFromCategory(categoryName) {
        try {
            const categoryUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${POSTS_DIR}/${categoryName}`;
            const response = await fetch(categoryUrl);

            if (!response.ok) throw new Error(`Failed to fetch posts from ${categoryName}: ${response.status}`);

            const files = await response.json();
            const mdFiles = files.filter(file => file.name.endsWith('.md') && file.type === 'file');
            mdFiles.sort((a, b) => b.name.localeCompare(a.name));

            return mdFiles.map(file => ({
                ...file,
                category: categoryName
            }));

        } catch (error) {
            console.error(`Error loading posts from ${categoryName}:`, error);
            return [];
        }
    }

    // Fallback: Load all posts directly if no categories
    async function loadAllPostsDirectly(container) {
        try {
            const apiUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${POSTS_DIR}`;
            const response = await fetch(apiUrl);

            if (!response.ok) throw new Error(`Failed to fetch posts: ${response.status}`);

            const files = await response.json();
            const mdFiles = files.filter(file => file.name.endsWith('.md') && file.type === 'file');
            mdFiles.sort((a, b) => b.name.localeCompare(a.name));

            if (mdFiles.length === 0) {
                container.innerHTML = '<div class="error">No posts found.</div>';
                return;
            }

            let html = '<div class="categories-container">';
            html += renderCategorySection('All Posts', mdFiles.map(file => ({
                ...file,
                category: 'uncategorized'
            })));
            html += '</div>';
            container.innerHTML = html;

            // Add event listeners to post cards
            document.querySelectorAll('.post-card-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    loadPost(this.getAttribute('data-file'), '');
                });
            });

        } catch (error) {
            console.error('Error loading posts directly:', error);
            container.innerHTML = `<div class="error">Failed to load posts: ${error.message}</div>`;
        }
    }

    // Render a category section with its posts
    function renderCategorySection(categoryName, posts) {
        if (posts.length === 0) return '';

        const formattedCategory = formatCategoryName(categoryName);

        let html = `
            <div class="category-section">
                <div class="category-header">
                    <h3 class="category-title">${formattedCategory}</h3>
                    <span class="post-count">${posts.length} post${posts.length !== 1 ? 's' : ''}</span>
                </div>
                <div class="posts-grid">
        `;

        posts.forEach(post => {
            const fileName = post.name.replace('.md', '');
            const dateMatch = fileName.match(/^(\d{4}-\d{2}-\d{2})-/);
            const date = dateMatch ? dateMatch[1] : 'Unknown date';
            const title = dateMatch ? fileName.replace(dateMatch[0], '') : fileName;

            html += `
                <div class="post-card">
                    <a href="#" class="post-card-link" data-file="${post.name}" data-category="${post.category}">
                        <div class="post-card-content">
                            <div class="post-card-category">${formattedCategory}</div>
                            <h3 class="post-card-title">${formatTitle(title)}</h3>
                            <p class="post-card-date">${date}</p>
                            <p class="post-card-excerpt">Click to read this post...</p>
                        </div>
                    </a>
                </div>
            `;
        });

        html += `
                </div>
            </div>
        `;

        return html;
    }

    // Load and display a specific post
    async function loadPost(filename, category = '') {
        try {
            showSection('single-post');
            const container = document.getElementById('post-content');
            container.innerHTML = '<div class="loading">Loading post...</div>';

            // Construct the path based on whether we have a category
            const postPath = category ?
                `${POSTS_DIR}/${category}/${filename}` :
                `${POSTS_DIR}/${filename}`;

            const rawUrl = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${postPath}`;
            const response = await fetch(rawUrl);

            if (!response.ok) throw new Error(`Failed to fetch post: ${response.status}`);

            const markdown = await response.text();
            const htmlContent = marked.parse(markdown);
            const title = formatTitle(filename.replace('.md', ''));

            container.innerHTML = `
                <a href="#posts" class="back-btn">← Back to all posts</a>
                <article class="post-content">
                    <header class="post-header">
                        <div class="post-category">${formatCategoryName(category)}</div>
                        <h1>${title}</h1>
                        <div class="post-meta">
                            <span class="post-date">${filename.split('-').slice(0,3).join('-')}</span>
                        </div>
                    </header>
                    ${htmlContent}
                </article>
            `;

            // Add back button event
            container.querySelector('.back-btn').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('posts');
            });

        } catch (error) {
            console.error('Error loading post:', error);
            document.getElementById('post-content').innerHTML = `
                <div class="error">Failed to load post: ${error.message}</div>
                <a href="#posts" class="back-btn">← Back to all posts</a>
            `;
        }
    }

    // Helper function to format category names
    function formatCategoryName(category) {
        if (!category || category === 'uncategorized') return 'General';
        return category
            .split('-')
            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');
    }

    function formatTitle(str) {
        return str.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
    }
</script>
</body>
</html>
